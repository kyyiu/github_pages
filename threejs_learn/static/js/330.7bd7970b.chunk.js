"use strict";(self.webpackChunkthree=self.webpackChunkthree||[]).push([[330],{3330:function(r,e,n){n.r(e),n.d(e,{default:function(){return i}});var t=n(2791),a={bg_fsh:"#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\n\nuniform vec2 uTimes;\n\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\n\nvoid main(void) {\n    vec3 col;\n    float c;\n    vec2 tmpv = texCoord * vec2(0.8, 1.0) - vec2(0.95, 1.0);\n    c = exp(-pow(length(tmpv) * 1.8, 2.0));\n    col = mix(vec3(0.02, 0.0, 0.03), vec3(0.96, 0.98, 1.0) * 1.5, c);\n    gl_FragColor = vec4(col * 0.5, 1.0);\n}",fx_brightbuf_fsh:"#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\nuniform sampler2D uSrc;\nuniform vec2 uDelta;\n\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\n\nvoid main(void) {\n    vec4 col = texture2D(uSrc, texCoord);\n    gl_FragColor = vec4(col.rgb * 2.0 - vec3(0.5), 1.0);\n}",fx_common_fsh:"#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\nuniform sampler2D uSrc;\nuniform vec2 uDelta;\n\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\n\nvoid main(void) {\n    gl_FragColor = texture2D(uSrc, texCoord);\n}",fx_common_vsh:"uniform vec3 uResolution;\nattribute vec2 aPosition;\n\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\n\nvoid main(void) {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);\n    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);\n}",fx_dirblur_r4_fsh:"#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\nuniform sampler2D uSrc;\nuniform vec2 uDelta;\nuniform vec4 uBlurDir; //dir(x, y), stride(z, w)\n\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\n\nvoid main(void) {\n    vec4 col = texture2D(uSrc, texCoord);\n    col = col + texture2D(uSrc, texCoord + uBlurDir.xy * uDelta);\n    col = col + texture2D(uSrc, texCoord - uBlurDir.xy * uDelta);\n    col = col + texture2D(uSrc, texCoord + (uBlurDir.xy + uBlurDir.zw) * uDelta);\n    col = col + texture2D(uSrc, texCoord - (uBlurDir.xy + uBlurDir.zw) * uDelta);\n    gl_FragColor = col / 5.0;\n}",pp_final_fsh:"#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\nuniform sampler2D uSrc;\nuniform sampler2D uBloom;\nuniform vec2 uDelta;\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\nvoid main(void) {\n    vec4 srccol = texture2D(uSrc, texCoord) * 2.0;\n    vec4 bloomcol = texture2D(uBloom, texCoord);\n    vec4 col;\n    col = srccol + bloomcol * (vec4(1.0) + srccol);\n    col *= smoothstep(1.0, 0.0, pow(length((texCoord - vec2(0.5)) * 2.0), 1.2) * 0.5);\n    col = pow(col, vec4(0.45454545454545)); //(1.0 / 2.2)\n\n    gl_FragColor = vec4(col.rgb, 1.0);\n    gl_FragColor.a = 1.0;\n}",pp_final_vsh:"uniform vec3 uResolution;\nattribute vec2 aPosition;\nvarying vec2 texCoord;\nvarying vec2 screenCoord;\nvoid main(void) {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);\n    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);\n}",sakura_point_fsh:"#ifdef GL_ES\n//precision mediump float;\nprecision highp float;\n#endif\n\nuniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius\nuniform vec3 uFade; //x:start distance, y:half distance, z:near fade start\n\nconst vec3 fadeCol = vec3(0.08, 0.03, 0.06);\n\nvarying vec3 pposition;\nvarying float psize;\nvarying float palpha;\nvarying float pdist;\n\n//varying mat3 rotMat;\nvarying vec3 normX;\nvarying vec3 normY;\nvarying vec3 normZ;\nvarying vec3 normal;\n\nvarying float diffuse;\nvarying float specular;\nvarying float rstop;\nvarying float distancefade;\n\nfloat ellipse(vec2 p, vec2 o, vec2 r) {\n    vec2 lp = (p - o) / r;\n    return length(lp) - 1.0;\n}\n\nvoid main(void) {\n    vec3 p = vec3(gl_PointCoord - vec2(0.5, 0.5), 0.0) * 2.0;\n    vec3 d = vec3(0.0, 0.0, -1.0);\n    float nd = normZ.z; //dot(-normZ, d);\n    if(abs(nd) < 0.0001) discard;\n\n    float np = dot(normZ, p);\n    vec3 tp = p + d * np / nd;\n    vec2 coord = vec2(dot(normX, tp), dot(normY, tp));\n\n    //angle = 15 degree\n    const float flwrsn = 0.258819045102521;\n    const float flwrcs = 0.965925826289068;\n    mat2 flwrm = mat2(flwrcs, -flwrsn, flwrsn, flwrcs);\n    vec2 flwrp = vec2(abs(coord.x), coord.y) * flwrm;\n\n    float r;\n    if(flwrp.x < 0.0) {\n        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.36, 0.96) * 0.5);\n    }\n    else {\n        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.58, 0.96) * 0.5);\n    }\n\n    if(r > rstop) discard;\n\n    vec3 col = mix(vec3(1.0, 0.8, 0.75), vec3(1.0, 0.9, 0.87), r);\n    float grady = mix(0.0, 1.0, pow(coord.y * 0.5 + 0.5, 0.35));\n    col *= vec3(1.0, grady, grady);\n    col *= mix(0.8, 1.0, pow(abs(coord.x), 0.3));\n    col = col * diffuse + specular;\n\n    col = mix(fadeCol, col, distancefade);\n\n    float alpha = (rstop > 0.001)? (0.5 - r / (rstop * 2.0)) : 1.0;\n    alpha = smoothstep(0.0, 1.0, alpha) * palpha;\n\n    gl_FragColor = vec4(col * 0.5, alpha);\n}",sakura_point_vsh:"uniform mat4 uProjection;\nuniform mat4 uModelview;\nuniform vec3 uResolution;\nuniform vec3 uOffset;\nuniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius\nuniform vec3 uFade; //x:start distance, y:half distance, z:near fade start\n\nattribute vec3 aPosition;\nattribute vec3 aEuler;\nattribute vec2 aMisc; //x:size, y:fade\n\nvarying vec3 pposition;\nvarying float psize;\nvarying float palpha;\nvarying float pdist;\n\n//varying mat3 rotMat;\nvarying vec3 normX;\nvarying vec3 normY;\nvarying vec3 normZ;\nvarying vec3 normal;\n\nvarying float diffuse;\nvarying float specular;\nvarying float rstop;\nvarying float distancefade;\n\nvoid main(void) {\n    // Projection is based on vertical angle\n    vec4 pos = uModelview * vec4(aPosition + uOffset, 1.0);\n    gl_Position = uProjection * pos;\n    gl_PointSize = aMisc.x * uProjection[1][1] / -pos.z * uResolution.y * 0.5;\n\n    pposition = pos.xyz;\n    psize = aMisc.x;\n    pdist = length(pos.xyz);\n    palpha = smoothstep(0.0, 1.0, (pdist - 0.1) / uFade.z);\n\n    vec3 elrsn = sin(aEuler);\n    vec3 elrcs = cos(aEuler);\n    mat3 rotx = mat3(\n        1.0, 0.0, 0.0,\n        0.0, elrcs.x, elrsn.x,\n        0.0, -elrsn.x, elrcs.x\n    );\n    mat3 roty = mat3(\n        elrcs.y, 0.0, -elrsn.y,\n        0.0, 1.0, 0.0,\n        elrsn.y, 0.0, elrcs.y\n    );\n    mat3 rotz = mat3(\n        elrcs.z, elrsn.z, 0.0,\n        -elrsn.z, elrcs.z, 0.0,\n        0.0, 0.0, 1.0\n    );\n    mat3 rotmat = rotx * roty * rotz;\n    normal = rotmat[2];\n\n    mat3 trrotm = mat3(\n        rotmat[0][0], rotmat[1][0], rotmat[2][0],\n        rotmat[0][1], rotmat[1][1], rotmat[2][1],\n        rotmat[0][2], rotmat[1][2], rotmat[2][2]\n    );\n    normX = trrotm[0];\n    normY = trrotm[1];\n    normZ = trrotm[2];\n\n    const vec3 lit = vec3(0.6917144638660746, 0.6917144638660746, -0.20751433915982237);\n\n    float tmpdfs = dot(lit, normal);\n    if(tmpdfs < 0.0) {\n        normal = -normal;\n        tmpdfs = dot(lit, normal);\n    }\n    diffuse = 0.4 + tmpdfs;\n\n    vec3 eyev = normalize(-pos.xyz);\n    if(dot(eyev, normal) > 0.0) {\n        vec3 hv = normalize(eyev + lit);\n        specular = pow(max(dot(hv, normal), 0.0), 20.0);\n    }\n    else {\n        specular = 0.0;\n    }\n\n    rstop = clamp((abs(pdist - uDOF.x) - uDOF.y) / uDOF.z, 0.0, 1.0);\n    rstop = pow(rstop, 0.5);\n    //-0.69315 = ln(0.5)\n    distancefade = min(1.0, exp((uFade.x - pdist) * 0.69315 / uFade.y));\n}"},o=n(184);function i(){return(0,t.useEffect)((function(){!function(){var r,e,n={},t={};n.create=function(r,e,n){return{x:r,y:e,z:n}},n.dot=function(r,e){return r.x*e.x+r.y*e.y+r.z*e.z},n.cross=function(r,e,n){r.x=e.y*n.z-e.z*n.y,r.y=e.z*n.x-e.x*n.z,r.z=e.x*n.y-e.y*n.x},n.normalize=function(r){var e=r.x*r.x+r.y*r.y+r.z*r.z;e>1e-5&&(e=1/Math.sqrt(e),r.x*=e,r.y*=e,r.z*=e)},n.arrayForm=function(r){return r.array?(r.array[0]=r.x,r.array[1]=r.y,r.array[2]=r.z):r.array=new Float32Array([r.x,r.y,r.z]),r.array},t.createIdentity=function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},t.loadProjection=function(r,e,n,t,a){var o=t*Math.tan(n*Math.PI/180*.5)*2,i=o*e;r[0]=2*t/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*t/o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=-(a+t)/(a-t),r[11]=-1,r[12]=0,r[13]=0,r[14]=-2*a*t/(a-t),r[15]=0},t.loadLookAt=function(r,e,t,a){var o=n.create(e.x-t.x,e.y-t.y,e.z-t.z);n.normalize(o);var i=n.create(1,0,0);n.cross(i,a,o),n.normalize(i);var f=n.create(1,0,0);n.cross(f,o,i),n.normalize(f),r[0]=i.x,r[1]=f.x,r[2]=o.x,r[3]=0,r[4]=i.y,r[5]=f.y,r[6]=o.y,r[7]=0,r[8]=i.z,r[9]=f.z,r[10]=o.z,r[11]=0,r[12]=-(e.x*r[0]+e.y*r[4]+e.z*r[8]),r[13]=-(e.x*r[1]+e.y*r[5]+e.z*r[9]),r[14]=-(e.x*r[2]+e.y*r[6]+e.z*r[10]),r[15]=1};var o,i={start:0,prev:0,delta:0,elapsed:0},f={width:0,height:0,aspect:1,array:new Float32Array(3),halfWidth:0,halfHeight:0,halfArray:new Float32Array(3)};function l(r){o.deleteFramebuffer(r.frameBuffer),o.deleteRenderbuffer(r.renderBuffer),o.deleteTexture(r.texture)}function u(r,e){var n={width:r,height:e,sizeArray:new Float32Array([r,e,r/e]),dtxArray:new Float32Array([1/r,1/e])};return n.frameBuffer=o.createFramebuffer(),n.renderBuffer=o.createRenderbuffer(),n.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,n.texture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,r,e,0,o.RGBA,o.UNSIGNED_BYTE,null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.bindFramebuffer(o.FRAMEBUFFER,n.frameBuffer),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,n.texture,0),o.bindRenderbuffer(o.RENDERBUFFER,n.renderBuffer),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_COMPONENT16,r,e),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,n.renderBuffer),o.bindTexture(o.TEXTURE_2D,null),o.bindRenderbuffer(o.RENDERBUFFER,null),o.bindFramebuffer(o.FRAMEBUFFER,null),n}function s(r,e){var n=o.createShader(r);if(o.shaderSource(n,e),o.compileShader(n),!o.getShaderParameter(n,o.COMPILE_STATUS)){var t=o.getShaderInfoLog(n);return o.deleteShader(n),console.error(t),null}return n}function c(r,e,n,t){var a=s(o.VERTEX_SHADER,r),i=s(o.FRAGMENT_SHADER,e);if(null==a||null==i)return null;var f=o.createProgram();if(o.attachShader(f,a),o.attachShader(f,i),o.deleteShader(a),o.deleteShader(i),o.linkProgram(f),!o.getProgramParameter(f,o.LINK_STATUS)){var l=o.getProgramInfoLog(f);return console.error(l),null}if(n){f.uniforms={};for(var u=0;u<n.length;u++)f.uniforms[n[u]]=o.getUniformLocation(f,n[u])}if(t){f.attributes={};for(u=0;u<t.length;u++){var c=t[u];f.attributes[c]=o.getAttribLocation(f,c)}}return f}function d(r){for(var e in o.useProgram(r),r.attributes)o.enableVertexAttribArray(r.attributes[e])}function m(r){for(var e in r.attributes)o.disableVertexAttribArray(r.attributes[e]);o.useProgram(null)}f.setSize=function(r,e){f.width=r,f.height=e,f.aspect=f.width/f.height,f.array[0]=f.width,f.array[1]=f.height,f.array[2]=f.aspect,f.halfWidth=Math.floor(r/2),f.halfHeight=Math.floor(e/2),f.halfArray[0]=f.halfWidth,f.halfArray[1]=f.halfHeight,f.halfArray[2]=f.halfWidth/f.halfHeight};var v={angle:60,nearfar:new Float32Array([.1,100]),matrix:t.createIdentity()},p={position:n.create(0,0,100),lookat:n.create(0,0,0),up:n.create(0,1,0),dof:n.create(10,4,8),matrix:t.createIdentity()},y={},h=!1,g=function(){this.velocity=new Array(3),this.rotation=new Array(3),this.position=new Array(3),this.euler=new Array(3),this.size=1,this.alpha=1,this.zkey=0};function x(){var r=o.getParameter(o.ALIASED_POINT_SIZE_RANGE);f.pointSize={min:r[0],max:r[1]};var e=a.sakura_point_vsh,t=a.sakura_point_fsh;y.program=c(e,t,["uProjection","uModelview","uResolution","uOffset","uDOF","uFade"],["aPosition","aEuler","aMisc"]),d(y.program),y.offset=new Float32Array([0,0,0]),y.fader=n.create(0,10,0),y.numFlowers=1600,y.particles=new Array(y.numFlowers),y.dataArray=new Float32Array(8*y.numFlowers),y.positionArrayOffset=0,y.eulerArrayOffset=3*y.numFlowers,y.miscArrayOffset=6*y.numFlowers,y.buffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,y.buffer),o.bufferData(o.ARRAY_BUFFER,y.dataArray,o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,null),m(y.program);for(var i=0;i<y.numFlowers;i++)y.particles[i]=new g}function E(){y.area=n.create(20,20,20),y.area.x=y.area.y*f.aspect,y.fader.x=10,y.fader.y=y.area.z,y.fader.z=.1;for(var r=2*Math.PI,e=n.create(0,0,0),t=0,a=function(){return 2*Math.random()-1},o=0;o<y.numFlowers;o++){var i=y.particles[o];e.x=.3*a()+.8,e.y=.2*a()-1,e.z=.3*a()+.5,n.normalize(e),t=2+1*Math.random(),i.setVelocity(e.x*t,e.y*t,e.z*t),i.setRotation(a()*r*.5,a()*r*.5,a()*r*.5),i.setPosition(a()*y.area.x,a()*y.area.y,a()*y.area.z),i.setEulerAngles(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),i.setSize(.9+.1*Math.random())}}function R(){for(var r=2*Math.PI,e=(y.area.x,y.area.y,y.area.z,function(r,e,n){Math.abs(r.position[e])-.5*r.size>n&&(r.position[e]>0?r.position[e]-=2*n:r.position[e]+=2*n)}),t=function(e,n){e.euler[n]=e.euler[n]%r,e.euler[n]<0&&(e.euler[n]+=r)},a=0;a<y.numFlowers;a++){(c=y.particles[a]).update(i.delta,i.elapsed),e(c,0,y.area.x),e(c,1,y.area.y),e(c,2,y.area.z),t(c,0),t(c,1),t(c,2),c.alpha=1,c.zkey=p.matrix[2]*c.position[0]+p.matrix[6]*c.position[1]+p.matrix[10]*c.position[2]+p.matrix[14]}y.particles.sort((function(r,e){return r.zkey-e.zkey}));var l=y.positionArrayOffset,u=y.eulerArrayOffset,s=y.miscArrayOffset;for(a=0;a<y.numFlowers;a++){var c=y.particles[a];y.dataArray[l]=c.position[0],y.dataArray[l+1]=c.position[1],y.dataArray[l+2]=c.position[2],l+=3,y.dataArray[u]=c.euler[0],y.dataArray[u+1]=c.euler[1],y.dataArray[u+2]=c.euler[2],u+=3,y.dataArray[s]=c.size,y.dataArray[s+1]=c.alpha,s+=2}o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA);var h=y.program;d(h),o.uniformMatrix4fv(h.uniforms.uProjection,!1,v.matrix),o.uniformMatrix4fv(h.uniforms.uModelview,!1,p.matrix),o.uniform3fv(h.uniforms.uResolution,f.array),o.uniform3fv(h.uniforms.uDOF,n.arrayForm(p.dof)),o.uniform3fv(h.uniforms.uFade,n.arrayForm(y.fader)),o.bindBuffer(o.ARRAY_BUFFER,y.buffer),o.bufferData(o.ARRAY_BUFFER,y.dataArray,o.DYNAMIC_DRAW),o.vertexAttribPointer(h.attributes.aPosition,3,o.FLOAT,!1,0,y.positionArrayOffset*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribPointer(h.attributes.aEuler,3,o.FLOAT,!1,0,y.eulerArrayOffset*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribPointer(h.attributes.aMisc,2,o.FLOAT,!1,0,y.miscArrayOffset*Float32Array.BYTES_PER_ELEMENT);for(a=1;a<2;a++){var g=-2*a;y.offset[0]=-1*y.area.x,y.offset[1]=-1*y.area.y,y.offset[2]=y.area.z*g,o.uniform3fv(h.uniforms.uOffset,y.offset),o.drawArrays(o.POINT,0,y.numFlowers),y.offset[0]=-1*y.area.x,y.offset[1]=1*y.area.y,y.offset[2]=y.area.z*g,o.uniform3fv(h.uniforms.uOffset,y.offset),o.drawArrays(o.POINT,0,y.numFlowers),y.offset[0]=1*y.area.x,y.offset[1]=-1*y.area.y,y.offset[2]=y.area.z*g,o.uniform3fv(h.uniforms.uOffset,y.offset),o.drawArrays(o.POINT,0,y.numFlowers),y.offset[0]=1*y.area.x,y.offset[1]=1*y.area.y,y.offset[2]=y.area.z*g,o.uniform3fv(h.uniforms.uOffset,y.offset),o.drawArrays(o.POINT,0,y.numFlowers)}y.offset[0]=0,y.offset[1]=0,y.offset[2]=0,o.uniform3fv(h.uniforms.uOffset,y.offset),o.drawArrays(o.POINT,0,y.numFlowers),o.bindBuffer(o.ARRAY_BUFFER,null),m(h),o.enable(o.DEPTH_TEST),o.disable(o.BLEND)}function A(r,e,n,t){var a={},i=["uResolution","uSrc","uDelta"];n&&(i=i.concat(n));var f=["aPosition"];return t&&(f=f.concat(t)),a.program=c(r,e,i,f),d(a.program),a.dataArray=new Float32Array([-1,-1,1,-1,-1,1,1,1]),a.buffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,a.buffer),o.bufferData(o.ARRAY_BUFFER,a.dataArray,o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,null),m(a.program),a}function F(r,e){var n=r.program;d(n),o.uniform3fv(n.uniforms.uResolution,f.array),null!=e&&(o.uniform2fv(n.uniforms.uDelta,e.dtxArray),o.uniform1i(n.uniforms.uSrc,0),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,e.texture))}function T(r){o.bindBuffer(o.ARRAY_BUFFER,r.buffer),o.vertexAttribPointer(r.program.attributes.aPosition,2,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLE_STRIP,0,4)}function _(r){m(r.program)}g.prototype.setVelocity=function(r,e,n){this.velocity[0]=r,this.velocity[1]=e,this.velocity[2]=n},g.prototype.setRotation=function(r,e,n){this.rotation[0]=r,this.rotation[1]=e,this.rotation[2]=n},g.prototype.setPosition=function(r,e,n){this.position[0]=r,this.position[1]=e,this.position[2]=n},g.prototype.setEulerAngles=function(r,e,n){this.euler[0]=r,this.euler[1]=e,this.euler[2]=n},g.prototype.setSize=function(r){this.size=r},g.prototype.update=function(r,e){this.position[0]+=this.velocity[0]*r,this.position[1]+=this.velocity[1]*r,this.position[2]+=this.velocity[2]*r,this.euler[0]+=this.rotation[0]*r,this.euler[1]+=this.rotation[1]*r,this.euler[2]+=this.rotation[2]*r};var w={};function b(){var r,e,n=a.fx_common_vsh;e=a.bg_fsh,w.sceneBg=A(n,e,["uTimes"],null),e=a.fx_brightbuf_fsh,w.mkBrightBuf=A(n,e,null,null),e=a.fx_dirblur_r4_fsh,w.dirBlur=A(n,e,["uBlurDir"],null),r=a.pp_final_vsh,e=a.pp_final_fsh,w.finalComp=A(r,e,["uBloom"],null)}function B(){}function z(){}function D(){o.disable(o.DEPTH_TEST),F(w.sceneBg,null),o.uniform2f(w.sceneBg.program.uniforms.uTimes,i.elapsed,i.delta),T(w.sceneBg),_(w.sceneBg),o.enable(o.DEPTH_TEST)}function P(){}function C(){}function S(){o.disable(o.DEPTH_TEST);var r=function(r,e){o.bindFramebuffer(o.FRAMEBUFFER,r.frameBuffer),o.viewport(0,0,r.width,r.height),e&&(o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT))};r(f.wHalfRT0,!0),F(w.mkBrightBuf,f.mainRT),T(w.mkBrightBuf),_(w.mkBrightBuf);for(var e=0;e<2;e++){var n=1.5+1*e,t=2+1*e;r(f.wHalfRT1,!0),F(w.dirBlur,f.wHalfRT0),o.uniform4f(w.dirBlur.program.uniforms.uBlurDir,n,0,t,0),T(w.dirBlur),_(w.dirBlur),r(f.wHalfRT0,!0),F(w.dirBlur,f.wHalfRT1),o.uniform4f(w.dirBlur.program.uniforms.uBlurDir,0,n,0,t),T(w.dirBlur),_(w.dirBlur)}o.bindFramebuffer(o.FRAMEBUFFER,null),o.viewport(0,0,f.width,f.height),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),F(w.finalComp,f.mainRT),o.uniform1i(w.finalComp.program.uniforms.uBloom,1),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,f.wHalfRT0.texture),T(w.finalComp),_(w.finalComp),o.enable(o.DEPTH_TEST)}function M(){b(),B(),x(),P(),h=!0}function O(){z(),E(),C(),p.position.z=y.area.z+v.nearfar[0],v.angle=180*Math.atan2(y.area.y,p.position.z+y.area.z)/Math.PI*2,t.loadProjection(v.matrix,f.aspect,v.angle,v.nearfar[0],v.nearfar[1])}function U(){t.loadLookAt(p.matrix,p.position,p.lookat,p.up),o.enable(o.DEPTH_TEST),o.bindFramebuffer(o.FRAMEBUFFER,f.mainRT.frameBuffer),o.viewport(0,0,f.mainRT.width,f.mainRT.height),o.clearColor(.005,0,.05,0),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),D(),R(),S()}function I(r){X(document.getElementById("sakura")),L(),h&&O()}function L(){f.setSize(o.canvas.width,o.canvas.height),o.clearColor(.2,.2,.5,1),o.viewport(0,0,f.width,f.height);var r=function(r,e,n){var t=f[r];t&&l(t),f[r]=u(e,n)};r("mainRT",f.width,f.height),r("wFullRT0",f.width,f.height),r("wFullRT1",f.width,f.height),r("wHalfRT0",f.halfWidth,f.halfHeight),r("wHalfRT1",f.halfWidth,f.halfHeight)}function H(){U()}var N=!0;function k(){var r=new Date;i.elapsed=(r-i.start)/1e3,i.delta=(r-i.prev)/1e3,i.prev=r,N&&requestAnimationFrame(k),H()}function X(n){if(n){var t=document.body,a=document.documentElement;r=Math.min(t.clientWidth,a.clientWidth),e=Math.max(t.clientHeight,a.clientHeight),n.width=r||0,n.height=e||0}}var Y=document.getElementById("sakura");try{if(!Y)return void window.removeEventListener("resize",I);X(Y),o=Y.getContext("experimental-webgl")}catch(j){return alert("WebGL not supported."+j),void console.error(j)}window.addEventListener("resize",I),L(),M(),O(),i.start=new Date,i.prev=i.start,k(),G=window,W="equestAnimationFrame",G["r"+W]=G["r"+W]||G["webkitR"+W]||G["mozR"+W]||G["msR"+W]||G["oR"+W]||function(r){console.log("RRR"),G.setTimeout(r,1e3/60)};var G,W}()}),[]),(0,o.jsx)("canvas",{id:"sakura",style:{display:"block"}})}}}]);
//# sourceMappingURL=330.7bd7970b.chunk.js.map
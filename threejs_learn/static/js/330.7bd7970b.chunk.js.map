{"version":3,"file":"static/js/330.7bd7970b.chunk.js","mappings":"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","sources":["practice/shader/sakura/glsl/index.js","practice/shader/sakura/glsl/bg_fsh.js","practice/shader/sakura/glsl/fx_brightbuf_fsh.js","practice/shader/sakura/glsl/fx_common_fsh.js","practice/shader/sakura/glsl/fx_common_vsh.js","practice/shader/sakura/glsl/fx_dirblur_r4_fsh.js","practice/shader/sakura/glsl/pp_final_fsh.js","practice/shader/sakura/glsl/pp_final_vsh.js","practice/shader/sakura/glsl/sakura_point_fsh.js","practice/shader/sakura/glsl/sakura_point_vsh.js","practice/shader/sakura/sakura.js"],"sourcesContent":["import {bg_fsh} from './bg_fsh'\r\nimport {fx_brightbuf_fsh} from './fx_brightbuf_fsh'\r\nimport {fx_common_fsh} from './fx_common_fsh'\r\nimport {fx_common_vsh} from './fx_common_vsh'\r\nimport {fx_dirblur_r4_fsh} from './fx_dirblur_r4_fsh'\r\nimport {pp_final_fsh} from './pp_final_fsh'\r\nimport {pp_final_vsh} from './pp_final_vsh'\r\nimport {sakura_point_fsh} from './sakura_point_fsh'\r\nimport {sakura_point_vsh} from './sakura_point_vsh'\r\n\r\nexport default {\r\n    bg_fsh,\r\n    fx_brightbuf_fsh,\r\n    fx_common_fsh,\r\n    fx_common_vsh,\r\n    fx_dirblur_r4_fsh,\r\n    pp_final_fsh,\r\n    pp_final_vsh,\r\n    sakura_point_fsh,\r\n    sakura_point_vsh\r\n}","export const bg_fsh= `#ifdef GL_ES\r\n//precision mediump float;\r\nprecision highp float;\r\n#endif\r\n\r\nuniform vec2 uTimes;\r\n\r\nvarying vec2 texCoord;\r\nvarying vec2 screenCoord;\r\n\r\nvoid main(void) {\r\n    vec3 col;\r\n    float c;\r\n    vec2 tmpv = texCoord * vec2(0.8, 1.0) - vec2(0.95, 1.0);\r\n    c = exp(-pow(length(tmpv) * 1.8, 2.0));\r\n    col = mix(vec3(0.02, 0.0, 0.03), vec3(0.96, 0.98, 1.0) * 1.5, c);\r\n    gl_FragColor = vec4(col * 0.5, 1.0);\r\n}`","export const fx_brightbuf_fsh = `#ifdef GL_ES\r\n//precision mediump float;\r\nprecision highp float;\r\n#endif\r\nuniform sampler2D uSrc;\r\nuniform vec2 uDelta;\r\n\r\nvarying vec2 texCoord;\r\nvarying vec2 screenCoord;\r\n\r\nvoid main(void) {\r\n    vec4 col = texture2D(uSrc, texCoord);\r\n    gl_FragColor = vec4(col.rgb * 2.0 - vec3(0.5), 1.0);\r\n}`","export const fx_common_fsh = `#ifdef GL_ES\r\n//precision mediump float;\r\nprecision highp float;\r\n#endif\r\nuniform sampler2D uSrc;\r\nuniform vec2 uDelta;\r\n\r\nvarying vec2 texCoord;\r\nvarying vec2 screenCoord;\r\n\r\nvoid main(void) {\r\n    gl_FragColor = texture2D(uSrc, texCoord);\r\n}`","export const fx_common_vsh = `uniform vec3 uResolution;\r\nattribute vec2 aPosition;\r\n\r\nvarying vec2 texCoord;\r\nvarying vec2 screenCoord;\r\n\r\nvoid main(void) {\r\n    gl_Position = vec4(aPosition, 0.0, 1.0);\r\n    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);\r\n    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);\r\n}`","export const fx_dirblur_r4_fsh = `#ifdef GL_ES\r\n//precision mediump float;\r\nprecision highp float;\r\n#endif\r\nuniform sampler2D uSrc;\r\nuniform vec2 uDelta;\r\nuniform vec4 uBlurDir; //dir(x, y), stride(z, w)\r\n\r\nvarying vec2 texCoord;\r\nvarying vec2 screenCoord;\r\n\r\nvoid main(void) {\r\n    vec4 col = texture2D(uSrc, texCoord);\r\n    col = col + texture2D(uSrc, texCoord + uBlurDir.xy * uDelta);\r\n    col = col + texture2D(uSrc, texCoord - uBlurDir.xy * uDelta);\r\n    col = col + texture2D(uSrc, texCoord + (uBlurDir.xy + uBlurDir.zw) * uDelta);\r\n    col = col + texture2D(uSrc, texCoord - (uBlurDir.xy + uBlurDir.zw) * uDelta);\r\n    gl_FragColor = col / 5.0;\r\n}`","export const pp_final_fsh = `#ifdef GL_ES\r\n//precision mediump float;\r\nprecision highp float;\r\n#endif\r\nuniform sampler2D uSrc;\r\nuniform sampler2D uBloom;\r\nuniform vec2 uDelta;\r\nvarying vec2 texCoord;\r\nvarying vec2 screenCoord;\r\nvoid main(void) {\r\n    vec4 srccol = texture2D(uSrc, texCoord) * 2.0;\r\n    vec4 bloomcol = texture2D(uBloom, texCoord);\r\n    vec4 col;\r\n    col = srccol + bloomcol * (vec4(1.0) + srccol);\r\n    col *= smoothstep(1.0, 0.0, pow(length((texCoord - vec2(0.5)) * 2.0), 1.2) * 0.5);\r\n    col = pow(col, vec4(0.45454545454545)); //(1.0 / 2.2)\r\n\r\n    gl_FragColor = vec4(col.rgb, 1.0);\r\n    gl_FragColor.a = 1.0;\r\n}`","export const pp_final_vsh = `uniform vec3 uResolution;\r\nattribute vec2 aPosition;\r\nvarying vec2 texCoord;\r\nvarying vec2 screenCoord;\r\nvoid main(void) {\r\n    gl_Position = vec4(aPosition, 0.0, 1.0);\r\n    texCoord = aPosition.xy * 0.5 + vec2(0.5, 0.5);\r\n    screenCoord = aPosition.xy * vec2(uResolution.z, 1.0);\r\n}`","export const sakura_point_fsh = `#ifdef GL_ES\r\n//precision mediump float;\r\nprecision highp float;\r\n#endif\r\n\r\nuniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius\r\nuniform vec3 uFade; //x:start distance, y:half distance, z:near fade start\r\n\r\nconst vec3 fadeCol = vec3(0.08, 0.03, 0.06);\r\n\r\nvarying vec3 pposition;\r\nvarying float psize;\r\nvarying float palpha;\r\nvarying float pdist;\r\n\r\n//varying mat3 rotMat;\r\nvarying vec3 normX;\r\nvarying vec3 normY;\r\nvarying vec3 normZ;\r\nvarying vec3 normal;\r\n\r\nvarying float diffuse;\r\nvarying float specular;\r\nvarying float rstop;\r\nvarying float distancefade;\r\n\r\nfloat ellipse(vec2 p, vec2 o, vec2 r) {\r\n    vec2 lp = (p - o) / r;\r\n    return length(lp) - 1.0;\r\n}\r\n\r\nvoid main(void) {\r\n    vec3 p = vec3(gl_PointCoord - vec2(0.5, 0.5), 0.0) * 2.0;\r\n    vec3 d = vec3(0.0, 0.0, -1.0);\r\n    float nd = normZ.z; //dot(-normZ, d);\r\n    if(abs(nd) < 0.0001) discard;\r\n\r\n    float np = dot(normZ, p);\r\n    vec3 tp = p + d * np / nd;\r\n    vec2 coord = vec2(dot(normX, tp), dot(normY, tp));\r\n\r\n    //angle = 15 degree\r\n    const float flwrsn = 0.258819045102521;\r\n    const float flwrcs = 0.965925826289068;\r\n    mat2 flwrm = mat2(flwrcs, -flwrsn, flwrsn, flwrcs);\r\n    vec2 flwrp = vec2(abs(coord.x), coord.y) * flwrm;\r\n\r\n    float r;\r\n    if(flwrp.x < 0.0) {\r\n        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.36, 0.96) * 0.5);\r\n    }\r\n    else {\r\n        r = ellipse(flwrp, vec2(0.065, 0.024) * 0.5, vec2(0.58, 0.96) * 0.5);\r\n    }\r\n\r\n    if(r > rstop) discard;\r\n\r\n    vec3 col = mix(vec3(1.0, 0.8, 0.75), vec3(1.0, 0.9, 0.87), r);\r\n    float grady = mix(0.0, 1.0, pow(coord.y * 0.5 + 0.5, 0.35));\r\n    col *= vec3(1.0, grady, grady);\r\n    col *= mix(0.8, 1.0, pow(abs(coord.x), 0.3));\r\n    col = col * diffuse + specular;\r\n\r\n    col = mix(fadeCol, col, distancefade);\r\n\r\n    float alpha = (rstop > 0.001)? (0.5 - r / (rstop * 2.0)) : 1.0;\r\n    alpha = smoothstep(0.0, 1.0, alpha) * palpha;\r\n\r\n    gl_FragColor = vec4(col * 0.5, alpha);\r\n}`","export const sakura_point_vsh = `uniform mat4 uProjection;\r\nuniform mat4 uModelview;\r\nuniform vec3 uResolution;\r\nuniform vec3 uOffset;\r\nuniform vec3 uDOF;  //x:focus distance, y:focus radius, z:max radius\r\nuniform vec3 uFade; //x:start distance, y:half distance, z:near fade start\r\n\r\nattribute vec3 aPosition;\r\nattribute vec3 aEuler;\r\nattribute vec2 aMisc; //x:size, y:fade\r\n\r\nvarying vec3 pposition;\r\nvarying float psize;\r\nvarying float palpha;\r\nvarying float pdist;\r\n\r\n//varying mat3 rotMat;\r\nvarying vec3 normX;\r\nvarying vec3 normY;\r\nvarying vec3 normZ;\r\nvarying vec3 normal;\r\n\r\nvarying float diffuse;\r\nvarying float specular;\r\nvarying float rstop;\r\nvarying float distancefade;\r\n\r\nvoid main(void) {\r\n    // Projection is based on vertical angle\r\n    vec4 pos = uModelview * vec4(aPosition + uOffset, 1.0);\r\n    gl_Position = uProjection * pos;\r\n    gl_PointSize = aMisc.x * uProjection[1][1] / -pos.z * uResolution.y * 0.5;\r\n\r\n    pposition = pos.xyz;\r\n    psize = aMisc.x;\r\n    pdist = length(pos.xyz);\r\n    palpha = smoothstep(0.0, 1.0, (pdist - 0.1) / uFade.z);\r\n\r\n    vec3 elrsn = sin(aEuler);\r\n    vec3 elrcs = cos(aEuler);\r\n    mat3 rotx = mat3(\r\n        1.0, 0.0, 0.0,\r\n        0.0, elrcs.x, elrsn.x,\r\n        0.0, -elrsn.x, elrcs.x\r\n    );\r\n    mat3 roty = mat3(\r\n        elrcs.y, 0.0, -elrsn.y,\r\n        0.0, 1.0, 0.0,\r\n        elrsn.y, 0.0, elrcs.y\r\n    );\r\n    mat3 rotz = mat3(\r\n        elrcs.z, elrsn.z, 0.0,\r\n        -elrsn.z, elrcs.z, 0.0,\r\n        0.0, 0.0, 1.0\r\n    );\r\n    mat3 rotmat = rotx * roty * rotz;\r\n    normal = rotmat[2];\r\n\r\n    mat3 trrotm = mat3(\r\n        rotmat[0][0], rotmat[1][0], rotmat[2][0],\r\n        rotmat[0][1], rotmat[1][1], rotmat[2][1],\r\n        rotmat[0][2], rotmat[1][2], rotmat[2][2]\r\n    );\r\n    normX = trrotm[0];\r\n    normY = trrotm[1];\r\n    normZ = trrotm[2];\r\n\r\n    const vec3 lit = vec3(0.6917144638660746, 0.6917144638660746, -0.20751433915982237);\r\n\r\n    float tmpdfs = dot(lit, normal);\r\n    if(tmpdfs < 0.0) {\r\n        normal = -normal;\r\n        tmpdfs = dot(lit, normal);\r\n    }\r\n    diffuse = 0.4 + tmpdfs;\r\n\r\n    vec3 eyev = normalize(-pos.xyz);\r\n    if(dot(eyev, normal) > 0.0) {\r\n        vec3 hv = normalize(eyev + lit);\r\n        specular = pow(max(dot(hv, normal), 0.0), 20.0);\r\n    }\r\n    else {\r\n        specular = 0.0;\r\n    }\r\n\r\n    rstop = clamp((abs(pdist - uDOF.x) - uDOF.y) / uDOF.z, 0.0, 1.0);\r\n    rstop = pow(rstop, 0.5);\r\n    //-0.69315 = ln(0.5)\r\n    distancefade = min(1.0, exp((uFade.x - pdist) * 0.69315 / uFade.y));\r\n}`","import React, { useEffect, useRef } from \"react\";\r\nimport sakura from \"./glsl\";\r\n\r\nexport default function () {\r\n  useEffect(() => {\r\n    init();\r\n  }, []);\r\n  function init() {\r\n    // Utilities\r\n    var Vector3 = {};\r\n    var Matrix44 = {};\r\n    let fullw, fullh;\r\n    Vector3.create = function (x, y, z) {\r\n      return { x: x, y: y, z: z };\r\n    };\r\n    Vector3.dot = function (v0, v1) {\r\n      return v0.x * v1.x + v0.y * v1.y + v0.z * v1.z;\r\n    };\r\n    Vector3.cross = function (v, v0, v1) {\r\n      v.x = v0.y * v1.z - v0.z * v1.y;\r\n      v.y = v0.z * v1.x - v0.x * v1.z;\r\n      v.z = v0.x * v1.y - v0.y * v1.x;\r\n    };\r\n    Vector3.normalize = function (v) {\r\n      var l = v.x * v.x + v.y * v.y + v.z * v.z;\r\n      if (l > 0.00001) {\r\n        l = 1.0 / Math.sqrt(l);\r\n        v.x *= l;\r\n        v.y *= l;\r\n        v.z *= l;\r\n      }\r\n    };\r\n    Vector3.arrayForm = function (v) {\r\n      if (v.array) {\r\n        v.array[0] = v.x;\r\n        v.array[1] = v.y;\r\n        v.array[2] = v.z;\r\n      } else {\r\n        v.array = new Float32Array([v.x, v.y, v.z]);\r\n      }\r\n      return v.array;\r\n    };\r\n    Matrix44.createIdentity = function () {\r\n      return new Float32Array([\r\n        1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0,\r\n        0.0, 1.0,\r\n      ]);\r\n    };\r\n    Matrix44.loadProjection = function (m, aspect, vdeg, near, far) {\r\n      var h = near * Math.tan(((vdeg * Math.PI) / 180.0) * 0.5) * 2.0;\r\n      var w = h * aspect;\r\n\r\n      m[0] = (2.0 * near) / w;\r\n      m[1] = 0.0;\r\n      m[2] = 0.0;\r\n      m[3] = 0.0;\r\n\r\n      m[4] = 0.0;\r\n      m[5] = (2.0 * near) / h;\r\n      m[6] = 0.0;\r\n      m[7] = 0.0;\r\n\r\n      m[8] = 0.0;\r\n      m[9] = 0.0;\r\n      m[10] = -(far + near) / (far - near);\r\n      m[11] = -1.0;\r\n\r\n      m[12] = 0.0;\r\n      m[13] = 0.0;\r\n      m[14] = (-2.0 * far * near) / (far - near);\r\n      m[15] = 0.0;\r\n    };\r\n    Matrix44.loadLookAt = function (m, vpos, vlook, vup) {\r\n      var frontv = Vector3.create(\r\n        vpos.x - vlook.x,\r\n        vpos.y - vlook.y,\r\n        vpos.z - vlook.z\r\n      );\r\n      Vector3.normalize(frontv);\r\n      var sidev = Vector3.create(1.0, 0.0, 0.0);\r\n      Vector3.cross(sidev, vup, frontv);\r\n      Vector3.normalize(sidev);\r\n      var topv = Vector3.create(1.0, 0.0, 0.0);\r\n      Vector3.cross(topv, frontv, sidev);\r\n      Vector3.normalize(topv);\r\n\r\n      m[0] = sidev.x;\r\n      m[1] = topv.x;\r\n      m[2] = frontv.x;\r\n      m[3] = 0.0;\r\n\r\n      m[4] = sidev.y;\r\n      m[5] = topv.y;\r\n      m[6] = frontv.y;\r\n      m[7] = 0.0;\r\n\r\n      m[8] = sidev.z;\r\n      m[9] = topv.z;\r\n      m[10] = frontv.z;\r\n      m[11] = 0.0;\r\n\r\n      m[12] = -(vpos.x * m[0] + vpos.y * m[4] + vpos.z * m[8]);\r\n      m[13] = -(vpos.x * m[1] + vpos.y * m[5] + vpos.z * m[9]);\r\n      m[14] = -(vpos.x * m[2] + vpos.y * m[6] + vpos.z * m[10]);\r\n      m[15] = 1.0;\r\n    };\r\n\r\n    //\r\n    var timeInfo = {\r\n      start: 0,\r\n      prev: 0, // Date\r\n      delta: 0,\r\n      elapsed: 0, // Number(sec)\r\n    };\r\n\r\n    //\r\n    var gl;\r\n    var renderSpec = {\r\n      width: 0,\r\n      height: 0,\r\n      aspect: 1,\r\n      array: new Float32Array(3),\r\n      halfWidth: 0,\r\n      halfHeight: 0,\r\n      halfArray: new Float32Array(3),\r\n      // and some render targets. see setViewport()\r\n    };\r\n    renderSpec.setSize = function (w, h) {\r\n      renderSpec.width = w;\r\n      renderSpec.height = h;\r\n      renderSpec.aspect = renderSpec.width / renderSpec.height;\r\n      renderSpec.array[0] = renderSpec.width;\r\n      renderSpec.array[1] = renderSpec.height;\r\n      renderSpec.array[2] = renderSpec.aspect;\r\n\r\n      renderSpec.halfWidth = Math.floor(w / 2);\r\n      renderSpec.halfHeight = Math.floor(h / 2);\r\n      renderSpec.halfArray[0] = renderSpec.halfWidth;\r\n      renderSpec.halfArray[1] = renderSpec.halfHeight;\r\n      renderSpec.halfArray[2] = renderSpec.halfWidth / renderSpec.halfHeight;\r\n    };\r\n\r\n    function deleteRenderTarget(rt) {\r\n      gl.deleteFramebuffer(rt.frameBuffer);\r\n      gl.deleteRenderbuffer(rt.renderBuffer);\r\n      gl.deleteTexture(rt.texture);\r\n    }\r\n\r\n    function createRenderTarget(w, h) {\r\n      var ret = {\r\n        width: w,\r\n        height: h,\r\n        sizeArray: new Float32Array([w, h, w / h]),\r\n        dtxArray: new Float32Array([1.0 / w, 1.0 / h]),\r\n      };\r\n      ret.frameBuffer = gl.createFramebuffer();\r\n      ret.renderBuffer = gl.createRenderbuffer();\r\n      ret.texture = gl.createTexture();\r\n\r\n      gl.bindTexture(gl.TEXTURE_2D, ret.texture);\r\n      gl.texImage2D(\r\n        gl.TEXTURE_2D,\r\n        0,\r\n        gl.RGBA,\r\n        w,\r\n        h,\r\n        0,\r\n        gl.RGBA,\r\n        gl.UNSIGNED_BYTE,\r\n        null\r\n      );\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, ret.frameBuffer);\r\n      gl.framebufferTexture2D(\r\n        gl.FRAMEBUFFER,\r\n        gl.COLOR_ATTACHMENT0,\r\n        gl.TEXTURE_2D,\r\n        ret.texture,\r\n        0\r\n      );\r\n\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, ret.renderBuffer);\r\n      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, w, h);\r\n      gl.framebufferRenderbuffer(\r\n        gl.FRAMEBUFFER,\r\n        gl.DEPTH_ATTACHMENT,\r\n        gl.RENDERBUFFER,\r\n        ret.renderBuffer\r\n      );\r\n\r\n      gl.bindTexture(gl.TEXTURE_2D, null);\r\n      gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n      return ret;\r\n    }\r\n\r\n    function compileShader(shtype, shsrc) {\r\n      var retsh = gl.createShader(shtype);\r\n\r\n      gl.shaderSource(retsh, shsrc);\r\n      gl.compileShader(retsh);\r\n\r\n      if (!gl.getShaderParameter(retsh, gl.COMPILE_STATUS)) {\r\n        var errlog = gl.getShaderInfoLog(retsh);\r\n        gl.deleteShader(retsh);\r\n        console.error(errlog);\r\n        return null;\r\n      }\r\n      return retsh;\r\n    }\r\n\r\n    function createShader(vtxsrc, frgsrc, uniformlist, attrlist) {\r\n      var vsh = compileShader(gl.VERTEX_SHADER, vtxsrc);\r\n      var fsh = compileShader(gl.FRAGMENT_SHADER, frgsrc);\r\n\r\n      if (vsh == null || fsh == null) {\r\n        return null;\r\n      }\r\n\r\n      var prog = gl.createProgram();\r\n      gl.attachShader(prog, vsh);\r\n      gl.attachShader(prog, fsh);\r\n\r\n      gl.deleteShader(vsh);\r\n      gl.deleteShader(fsh);\r\n\r\n      gl.linkProgram(prog);\r\n      if (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {\r\n        var errlog = gl.getProgramInfoLog(prog);\r\n        console.error(errlog);\r\n        return null;\r\n      }\r\n\r\n      if (uniformlist) {\r\n        prog.uniforms = {};\r\n        for (var i = 0; i < uniformlist.length; i++) {\r\n          prog.uniforms[uniformlist[i]] = gl.getUniformLocation(\r\n            prog,\r\n            uniformlist[i]\r\n          );\r\n        }\r\n      }\r\n\r\n      if (attrlist) {\r\n        prog.attributes = {};\r\n        for (var i = 0; i < attrlist.length; i++) {\r\n          var attr = attrlist[i];\r\n          prog.attributes[attr] = gl.getAttribLocation(prog, attr);\r\n        }\r\n      }\r\n\r\n      return prog;\r\n    }\r\n\r\n    function cShader(prog) {\r\n      gl.useProgram(prog);\r\n      for (var attr in prog.attributes) {\r\n        gl.enableVertexAttribArray(prog.attributes[attr]);\r\n      }\r\n    }\r\n\r\n    function uncShader(prog) {\r\n      for (var attr in prog.attributes) {\r\n        gl.disableVertexAttribArray(prog.attributes[attr]);\r\n      }\r\n      gl.useProgram(null);\r\n    }\r\n\r\n    /////\r\n    var projection = {\r\n      angle: 60,\r\n      nearfar: new Float32Array([0.1, 100.0]),\r\n      matrix: Matrix44.createIdentity(),\r\n    };\r\n    var camera = {\r\n      position: Vector3.create(0, 0, 100),\r\n      lookat: Vector3.create(0, 0, 0),\r\n      up: Vector3.create(0, 1, 0),\r\n      dof: Vector3.create(10.0, 4.0, 8.0),\r\n      matrix: Matrix44.createIdentity(),\r\n    };\r\n\r\n    var pointFlower = {};\r\n    var meshFlower = {};\r\n    var sceneStandBy = false;\r\n\r\n    var BlossomParticle = function () {\r\n      this.velocity = new Array(3);\r\n      this.rotation = new Array(3);\r\n      this.position = new Array(3);\r\n      this.euler = new Array(3);\r\n      this.size = 1.0;\r\n      this.alpha = 1.0;\r\n      this.zkey = 0.0;\r\n    };\r\n\r\n    BlossomParticle.prototype.setVelocity = function (vx, vy, vz) {\r\n      this.velocity[0] = vx;\r\n      this.velocity[1] = vy;\r\n      this.velocity[2] = vz;\r\n    };\r\n\r\n    BlossomParticle.prototype.setRotation = function (rx, ry, rz) {\r\n      this.rotation[0] = rx;\r\n      this.rotation[1] = ry;\r\n      this.rotation[2] = rz;\r\n    };\r\n\r\n    BlossomParticle.prototype.setPosition = function (nx, ny, nz) {\r\n      this.position[0] = nx;\r\n      this.position[1] = ny;\r\n      this.position[2] = nz;\r\n    };\r\n\r\n    BlossomParticle.prototype.setEulerAngles = function (rx, ry, rz) {\r\n      this.euler[0] = rx;\r\n      this.euler[1] = ry;\r\n      this.euler[2] = rz;\r\n    };\r\n\r\n    BlossomParticle.prototype.setSize = function (s) {\r\n      this.size = s;\r\n    };\r\n\r\n    BlossomParticle.prototype.update = function (dt, et) {\r\n      this.position[0] += this.velocity[0] * dt;\r\n      this.position[1] += this.velocity[1] * dt;\r\n      this.position[2] += this.velocity[2] * dt;\r\n\r\n      this.euler[0] += this.rotation[0] * dt;\r\n      this.euler[1] += this.rotation[1] * dt;\r\n      this.euler[2] += this.rotation[2] * dt;\r\n    };\r\n\r\n    function createPointFlowers() {\r\n      // get point sizes\r\n      var prm = gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE);\r\n      renderSpec.pointSize = { min: prm[0], max: prm[1] };\r\n\r\n      var vtxsrc = sakura.sakura_point_vsh;\r\n      var frgsrc = sakura.sakura_point_fsh;\r\n\r\n      pointFlower.program = createShader(\r\n        vtxsrc,\r\n        frgsrc,\r\n        [\r\n          \"uProjection\",\r\n          \"uModelview\",\r\n          \"uResolution\",\r\n          \"uOffset\",\r\n          \"uDOF\",\r\n          \"uFade\",\r\n        ],\r\n        [\"aPosition\", \"aEuler\", \"aMisc\"]\r\n      );\r\n\r\n      cShader(pointFlower.program);\r\n      pointFlower.offset = new Float32Array([0.0, 0.0, 0.0]);\r\n      pointFlower.fader = Vector3.create(0.0, 10.0, 0.0);\r\n\r\n      // paramerters: velocity[3], rotate[3]\r\n      pointFlower.numFlowers = 1600;\r\n      pointFlower.particles = new Array(pointFlower.numFlowers);\r\n      // vertex attributes {position[3], euler_xyz[3], size[1]}\r\n      pointFlower.dataArray = new Float32Array(\r\n        pointFlower.numFlowers * (3 + 3 + 2)\r\n      );\r\n      pointFlower.positionArrayOffset = 0;\r\n      pointFlower.eulerArrayOffset = pointFlower.numFlowers * 3;\r\n      pointFlower.miscArrayOffset = pointFlower.numFlowers * 6;\r\n\r\n      pointFlower.buffer = gl.createBuffer();\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, pointFlower.buffer);\r\n      gl.bufferData(gl.ARRAY_BUFFER, pointFlower.dataArray, gl.DYNAMIC_DRAW);\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n      uncShader(pointFlower.program);\r\n\r\n      for (var i = 0; i < pointFlower.numFlowers; i++) {\r\n        pointFlower.particles[i] = new BlossomParticle();\r\n      }\r\n    }\r\n\r\n    function initPointFlowers() {\r\n      //area\r\n      pointFlower.area = Vector3.create(20.0, 20.0, 20.0);\r\n      pointFlower.area.x = pointFlower.area.y * renderSpec.aspect;\r\n\r\n      pointFlower.fader.x = 10.0; //env fade start\r\n      pointFlower.fader.y = pointFlower.area.z; //env fade half\r\n      pointFlower.fader.z = 0.1; //near fade start\r\n\r\n      //particles\r\n      var PI2 = Math.PI * 2.0;\r\n      var tmpv3 = Vector3.create(0, 0, 0);\r\n      var tmpv = 0;\r\n      var symmetryrand = function () {\r\n        return Math.random() * 2.0 - 1.0;\r\n      };\r\n      for (var i = 0; i < pointFlower.numFlowers; i++) {\r\n        var tmpprtcl = pointFlower.particles[i];\r\n\r\n        //velocity\r\n        tmpv3.x = symmetryrand() * 0.3 + 0.8;\r\n        tmpv3.y = symmetryrand() * 0.2 - 1.0;\r\n        tmpv3.z = symmetryrand() * 0.3 + 0.5;\r\n        Vector3.normalize(tmpv3);\r\n        tmpv = 2.0 + Math.random() * 1.0;\r\n        tmpprtcl.setVelocity(tmpv3.x * tmpv, tmpv3.y * tmpv, tmpv3.z * tmpv);\r\n\r\n        //rotation\r\n        tmpprtcl.setRotation(\r\n          symmetryrand() * PI2 * 0.5,\r\n          symmetryrand() * PI2 * 0.5,\r\n          symmetryrand() * PI2 * 0.5\r\n        );\r\n\r\n        //position\r\n        tmpprtcl.setPosition(\r\n          symmetryrand() * pointFlower.area.x,\r\n          symmetryrand() * pointFlower.area.y,\r\n          symmetryrand() * pointFlower.area.z\r\n        );\r\n\r\n        //euler\r\n        tmpprtcl.setEulerAngles(\r\n          Math.random() * Math.PI * 2.0,\r\n          Math.random() * Math.PI * 2.0,\r\n          Math.random() * Math.PI * 2.0\r\n        );\r\n\r\n        //size\r\n        tmpprtcl.setSize(0.9 + Math.random() * 0.1);\r\n      }\r\n    }\r\n\r\n    function renderPointFlowers() {\r\n      //update\r\n      var PI2 = Math.PI * 2.0;\r\n      var limit = [pointFlower.area.x, pointFlower.area.y, pointFlower.area.z];\r\n      var repeatPos = function (prt, cmp, limit) {\r\n        if (Math.abs(prt.position[cmp]) - prt.size * 0.5 > limit) {\r\n          //out of area\r\n          if (prt.position[cmp] > 0) {\r\n            prt.position[cmp] -= limit * 2.0;\r\n          } else {\r\n            prt.position[cmp] += limit * 2.0;\r\n          }\r\n        }\r\n      };\r\n      var repeatEuler = function (prt, cmp) {\r\n        prt.euler[cmp] = prt.euler[cmp] % PI2;\r\n        if (prt.euler[cmp] < 0.0) {\r\n          prt.euler[cmp] += PI2;\r\n        }\r\n      };\r\n\r\n      for (var i = 0; i < pointFlower.numFlowers; i++) {\r\n        var prtcl = pointFlower.particles[i];\r\n        prtcl.update(timeInfo.delta, timeInfo.elapsed);\r\n        repeatPos(prtcl, 0, pointFlower.area.x);\r\n        repeatPos(prtcl, 1, pointFlower.area.y);\r\n        repeatPos(prtcl, 2, pointFlower.area.z);\r\n        repeatEuler(prtcl, 0);\r\n        repeatEuler(prtcl, 1);\r\n        repeatEuler(prtcl, 2);\r\n\r\n        prtcl.alpha = 1.0; //(pointFlower.area.z - prtcl.position[2]) * 0.5;\r\n\r\n        prtcl.zkey =\r\n          camera.matrix[2] * prtcl.position[0] +\r\n          camera.matrix[6] * prtcl.position[1] +\r\n          camera.matrix[10] * prtcl.position[2] +\r\n          camera.matrix[14];\r\n      }\r\n\r\n      // sort\r\n      pointFlower.particles.sort(function (p0, p1) {\r\n        return p0.zkey - p1.zkey;\r\n      });\r\n\r\n      // update data\r\n      var ipos = pointFlower.positionArrayOffset;\r\n      var ieuler = pointFlower.eulerArrayOffset;\r\n      var imisc = pointFlower.miscArrayOffset;\r\n      for (var i = 0; i < pointFlower.numFlowers; i++) {\r\n        var prtcl = pointFlower.particles[i];\r\n        pointFlower.dataArray[ipos] = prtcl.position[0];\r\n        pointFlower.dataArray[ipos + 1] = prtcl.position[1];\r\n        pointFlower.dataArray[ipos + 2] = prtcl.position[2];\r\n        ipos += 3;\r\n        pointFlower.dataArray[ieuler] = prtcl.euler[0];\r\n        pointFlower.dataArray[ieuler + 1] = prtcl.euler[1];\r\n        pointFlower.dataArray[ieuler + 2] = prtcl.euler[2];\r\n        ieuler += 3;\r\n        pointFlower.dataArray[imisc] = prtcl.size;\r\n        pointFlower.dataArray[imisc + 1] = prtcl.alpha;\r\n        imisc += 2;\r\n      }\r\n\r\n      //draw\r\n      gl.enable(gl.BLEND);\r\n      //gl.disable(gl.DEPTH_TEST);\r\n      gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n      var prog = pointFlower.program;\r\n      cShader(prog);\r\n\r\n      gl.uniformMatrix4fv(prog.uniforms.uProjection, false, projection.matrix);\r\n      gl.uniformMatrix4fv(prog.uniforms.uModelview, false, camera.matrix);\r\n      gl.uniform3fv(prog.uniforms.uResolution, renderSpec.array);\r\n      gl.uniform3fv(prog.uniforms.uDOF, Vector3.arrayForm(camera.dof));\r\n      gl.uniform3fv(prog.uniforms.uFade, Vector3.arrayForm(pointFlower.fader));\r\n\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, pointFlower.buffer);\r\n      gl.bufferData(gl.ARRAY_BUFFER, pointFlower.dataArray, gl.DYNAMIC_DRAW);\r\n\r\n      gl.vertexAttribPointer(\r\n        prog.attributes.aPosition,\r\n        3,\r\n        gl.FLOAT,\r\n        false,\r\n        0,\r\n        pointFlower.positionArrayOffset * Float32Array.BYTES_PER_ELEMENT\r\n      );\r\n      gl.vertexAttribPointer(\r\n        prog.attributes.aEuler,\r\n        3,\r\n        gl.FLOAT,\r\n        false,\r\n        0,\r\n        pointFlower.eulerArrayOffset * Float32Array.BYTES_PER_ELEMENT\r\n      );\r\n      gl.vertexAttribPointer(\r\n        prog.attributes.aMisc,\r\n        2,\r\n        gl.FLOAT,\r\n        false,\r\n        0,\r\n        pointFlower.miscArrayOffset * Float32Array.BYTES_PER_ELEMENT\r\n      );\r\n\r\n      // doubler\r\n      for (var i = 1; i < 2; i++) {\r\n        var zpos = i * -2.0;\r\n        pointFlower.offset[0] = pointFlower.area.x * -1.0;\r\n        pointFlower.offset[1] = pointFlower.area.y * -1.0;\r\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\r\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\r\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\r\n\r\n        pointFlower.offset[0] = pointFlower.area.x * -1.0;\r\n        pointFlower.offset[1] = pointFlower.area.y * 1.0;\r\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\r\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\r\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\r\n\r\n        pointFlower.offset[0] = pointFlower.area.x * 1.0;\r\n        pointFlower.offset[1] = pointFlower.area.y * -1.0;\r\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\r\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\r\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\r\n\r\n        pointFlower.offset[0] = pointFlower.area.x * 1.0;\r\n        pointFlower.offset[1] = pointFlower.area.y * 1.0;\r\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\r\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\r\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\r\n      }\r\n\r\n      //main\r\n      pointFlower.offset[0] = 0.0;\r\n      pointFlower.offset[1] = 0.0;\r\n      pointFlower.offset[2] = 0.0;\r\n      gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\r\n      gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\r\n\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n      uncShader(prog);\r\n\r\n      gl.enable(gl.DEPTH_TEST);\r\n      gl.disable(gl.BLEND);\r\n    }\r\n\r\n    // effects\r\n    //common util\r\n    function createEffectProgram(vtxsrc, frgsrc, exunifs, exattrs) {\r\n      var ret = {};\r\n      var unifs = [\"uResolution\", \"uSrc\", \"uDelta\"];\r\n      if (exunifs) {\r\n        unifs = unifs.concat(exunifs);\r\n      }\r\n      var attrs = [\"aPosition\"];\r\n      if (exattrs) {\r\n        attrs = attrs.concat(exattrs);\r\n      }\r\n\r\n      ret.program = createShader(vtxsrc, frgsrc, unifs, attrs);\r\n      cShader(ret.program);\r\n\r\n      ret.dataArray = new Float32Array([\r\n        -1.0, -1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0,\r\n      ]);\r\n      ret.buffer = gl.createBuffer();\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, ret.buffer);\r\n      gl.bufferData(gl.ARRAY_BUFFER, ret.dataArray, gl.STATIC_DRAW);\r\n\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n      uncShader(ret.program);\r\n\r\n      return ret;\r\n    }\r\n\r\n    // basic usage\r\n    // cEffect(prog, srctex({'texture':texid, 'dtxArray':(f32)[dtx, dty]})); //basic initialize\r\n    // gl.uniform**(...); //additional uniforms\r\n    // drawEffect()\r\n    // uncEffect(prog)\r\n    // TEXTURE0 makes src\r\n    function cEffect(fxobj, srctex) {\r\n      var prog = fxobj.program;\r\n      cShader(prog);\r\n      gl.uniform3fv(prog.uniforms.uResolution, renderSpec.array);\r\n\r\n      if (srctex != null) {\r\n        gl.uniform2fv(prog.uniforms.uDelta, srctex.dtxArray);\r\n        gl.uniform1i(prog.uniforms.uSrc, 0);\r\n\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, srctex.texture);\r\n      }\r\n    }\r\n    function drawEffect(fxobj) {\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, fxobj.buffer);\r\n      gl.vertexAttribPointer(\r\n        fxobj.program.attributes.aPosition,\r\n        2,\r\n        gl.FLOAT,\r\n        false,\r\n        0,\r\n        0\r\n      );\r\n      gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n    }\r\n    function uncEffect(fxobj) {\r\n      uncShader(fxobj.program);\r\n    }\r\n\r\n    var effectLib = {};\r\n    function createEffectLib() {\r\n      var vtxsrc, frgsrc;\r\n      //common\r\n      var cmnvtxsrc = sakura.fx_common_vsh;\r\n\r\n      //background\r\n      frgsrc = sakura.bg_fsh;\r\n      effectLib.sceneBg = createEffectProgram(\r\n        cmnvtxsrc,\r\n        frgsrc,\r\n        [\"uTimes\"],\r\n        null\r\n      );\r\n\r\n      // make brightpixels buffer\r\n      frgsrc = sakura.fx_brightbuf_fsh;\r\n      effectLib.mkBrightBuf = createEffectProgram(\r\n        cmnvtxsrc,\r\n        frgsrc,\r\n        null,\r\n        null\r\n      );\r\n\r\n      // direction blur\r\n      frgsrc = sakura.fx_dirblur_r4_fsh;\r\n      effectLib.dirBlur = createEffectProgram(\r\n        cmnvtxsrc,\r\n        frgsrc,\r\n        [\"uBlurDir\"],\r\n        null\r\n      );\r\n\r\n      //final composite\r\n      vtxsrc = sakura.pp_final_vsh;\r\n      frgsrc = sakura.pp_final_fsh;\r\n      effectLib.finalComp = createEffectProgram(\r\n        vtxsrc,\r\n        frgsrc,\r\n        [\"uBloom\"],\r\n        null\r\n      );\r\n    }\r\n\r\n    // background\r\n    function createBackground() {\r\n      //console.log(\"create background\");\r\n    }\r\n    function initBackground() {\r\n      //console.log(\"init background\");\r\n    }\r\n    function renderBackground() {\r\n      gl.disable(gl.DEPTH_TEST);\r\n\r\n      cEffect(effectLib.sceneBg, null);\r\n      gl.uniform2f(\r\n        effectLib.sceneBg.program.uniforms.uTimes,\r\n        timeInfo.elapsed,\r\n        timeInfo.delta\r\n      );\r\n      drawEffect(effectLib.sceneBg);\r\n      uncEffect(effectLib.sceneBg);\r\n\r\n      gl.enable(gl.DEPTH_TEST);\r\n    }\r\n\r\n    // post process\r\n    var postProcess = {};\r\n    function createPostProcess() {\r\n      //console.log(\"create post process\");\r\n    }\r\n    function initPostProcess() {\r\n      //console.log(\"init post process\");\r\n    }\r\n\r\n    function renderPostProcess() {\r\n    //   gl.enable(gl.TEXTURE_2D);\r\n      gl.disable(gl.DEPTH_TEST);\r\n      var bindRT = function (rt, isclear) {\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, rt.frameBuffer);\r\n        gl.viewport(0, 0, rt.width, rt.height);\r\n        if (isclear) {\r\n          gl.clearColor(0, 0, 0, 0);\r\n          gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n        }\r\n      };\r\n\r\n      //make bright buff\r\n      bindRT(renderSpec.wHalfRT0, true);\r\n      cEffect(effectLib.mkBrightBuf, renderSpec.mainRT);\r\n      drawEffect(effectLib.mkBrightBuf);\r\n      uncEffect(effectLib.mkBrightBuf);\r\n\r\n      // make bloom\r\n      for (var i = 0; i < 2; i++) {\r\n        var p = 1.5 + 1 * i;\r\n        var s = 2.0 + 1 * i;\r\n        bindRT(renderSpec.wHalfRT1, true);\r\n        cEffect(effectLib.dirBlur, renderSpec.wHalfRT0);\r\n        gl.uniform4f(\r\n          effectLib.dirBlur.program.uniforms.uBlurDir,\r\n          p,\r\n          0.0,\r\n          s,\r\n          0.0\r\n        );\r\n        drawEffect(effectLib.dirBlur);\r\n        uncEffect(effectLib.dirBlur);\r\n\r\n        bindRT(renderSpec.wHalfRT0, true);\r\n        cEffect(effectLib.dirBlur, renderSpec.wHalfRT1);\r\n        gl.uniform4f(\r\n          effectLib.dirBlur.program.uniforms.uBlurDir,\r\n          0.0,\r\n          p,\r\n          0.0,\r\n          s\r\n        );\r\n        drawEffect(effectLib.dirBlur);\r\n        uncEffect(effectLib.dirBlur);\r\n      }\r\n\r\n      //display\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n      gl.viewport(0, 0, renderSpec.width, renderSpec.height);\r\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n      cEffect(effectLib.finalComp, renderSpec.mainRT);\r\n      gl.uniform1i(effectLib.finalComp.program.uniforms.uBloom, 1);\r\n      gl.activeTexture(gl.TEXTURE1);\r\n      gl.bindTexture(gl.TEXTURE_2D, renderSpec.wHalfRT0.texture);\r\n      drawEffect(effectLib.finalComp);\r\n      uncEffect(effectLib.finalComp);\r\n\r\n      gl.enable(gl.DEPTH_TEST);\r\n    }\r\n\r\n    /////\r\n    var SceneEnv = {};\r\n    function createScene() {\r\n      createEffectLib();\r\n      createBackground();\r\n      createPointFlowers();\r\n      createPostProcess();\r\n      sceneStandBy = true;\r\n    }\r\n\r\n    function initScene() {\r\n      initBackground();\r\n      initPointFlowers();\r\n      initPostProcess();\r\n\r\n      //camera.position.z = 17.320508;\r\n      camera.position.z = pointFlower.area.z + projection.nearfar[0];\r\n      projection.angle =\r\n        ((Math.atan2(\r\n          pointFlower.area.y,\r\n          camera.position.z + pointFlower.area.z\r\n        ) *\r\n          180.0) /\r\n          Math.PI) *\r\n        2.0;\r\n      Matrix44.loadProjection(\r\n        projection.matrix,\r\n        renderSpec.aspect,\r\n        projection.angle,\r\n        projection.nearfar[0],\r\n        projection.nearfar[1]\r\n      );\r\n    }\r\n\r\n    function renderScene() {\r\n      //draw\r\n      Matrix44.loadLookAt(\r\n        camera.matrix,\r\n        camera.position,\r\n        camera.lookat,\r\n        camera.up\r\n      );\r\n\r\n      gl.enable(gl.DEPTH_TEST);\r\n\r\n      //gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n      gl.bindFramebuffer(gl.FRAMEBUFFER, renderSpec.mainRT.frameBuffer);\r\n      gl.viewport(0, 0, renderSpec.mainRT.width, renderSpec.mainRT.height);\r\n      gl.clearColor(0.005, 0, 0.05, 0);\r\n      gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n      renderBackground();\r\n      renderPointFlowers();\r\n      renderPostProcess();\r\n    }\r\n\r\n    /////\r\n    function onResize(e) {\r\n      makeCanvasFullScreen(document.getElementById(\"sakura\"));\r\n      setViewports();\r\n      if (sceneStandBy) {\r\n        initScene();\r\n      }\r\n    }\r\n\r\n    function setViewports() {\r\n      renderSpec.setSize(gl.canvas.width, gl.canvas.height);\r\n\r\n      gl.clearColor(0.2, 0.2, 0.5, 1.0);\r\n      gl.viewport(0, 0, renderSpec.width, renderSpec.height);\r\n\r\n      var rtfunc = function (rtname, rtw, rth) {\r\n        var rt = renderSpec[rtname];\r\n        if (rt) deleteRenderTarget(rt);\r\n        renderSpec[rtname] = createRenderTarget(rtw, rth);\r\n      };\r\n      rtfunc(\"mainRT\", renderSpec.width, renderSpec.height);\r\n      rtfunc(\"wFullRT0\", renderSpec.width, renderSpec.height);\r\n      rtfunc(\"wFullRT1\", renderSpec.width, renderSpec.height);\r\n      rtfunc(\"wHalfRT0\", renderSpec.halfWidth, renderSpec.halfHeight);\r\n      rtfunc(\"wHalfRT1\", renderSpec.halfWidth, renderSpec.halfHeight);\r\n    }\r\n\r\n    function render() {\r\n      renderScene();\r\n    }\r\n\r\n    var animating = true;\r\n    function toggleAnimation(elm) {\r\n      animating ^= true;\r\n      if (animating) animate();\r\n      if (elm) {\r\n        elm.innerHTML = animating ? \"Stop\" : \"Start\";\r\n      }\r\n    }\r\n\r\n    function stepAnimation() {\r\n      if (!animating) animate();\r\n    }\r\n\r\n    function animate() {\r\n      var curdate = new Date();\r\n      timeInfo.elapsed = (curdate - timeInfo.start) / 1000.0;\r\n      timeInfo.delta = (curdate - timeInfo.prev) / 1000.0;\r\n      timeInfo.prev = curdate;\r\n\r\n      if (animating) requestAnimationFrame(animate);\r\n      render();\r\n    }\r\n\r\n    function makeCanvasFullScreen(canvas) {\r\n      if (!canvas) {\r\n        return;\r\n      }\r\n      var b = document.body;\r\n      var d = document.documentElement;\r\n      fullw = Math.min(\r\n        b.clientWidth,\r\n        d.clientWidth\r\n      );\r\n      fullh = Math.max(\r\n        b.clientHeight,\r\n        d.clientHeight\r\n      );\r\n      canvas.width = fullw || 0;\r\n      canvas.height = fullh || 0;\r\n    }\r\n\r\n    var canvas = document.getElementById(\"sakura\");\r\n    try {\r\n      if (!canvas) {\r\n        window.removeEventListener(\"resize\", onResize);\r\n        return;\r\n      }\r\n      makeCanvasFullScreen(canvas);\r\n      gl = canvas.getContext(\"experimental-webgl\");\r\n    } catch (e) {\r\n      alert(\"WebGL not supported.\" + e);\r\n      console.error(e);\r\n      return;\r\n    }\r\n\r\n    window.addEventListener(\"resize\", onResize);\r\n\r\n    setViewports();\r\n    createScene();\r\n    initScene();\r\n\r\n    timeInfo.start = new Date();\r\n    timeInfo.prev = timeInfo.start;\r\n    animate();\r\n\r\n    //set window.requestAnimationFrame\r\n    (function (w, r) {\r\n      w[\"r\" + r] =\r\n        w[\"r\" + r] ||\r\n        w[\"webkitR\" + r] ||\r\n        w[\"mozR\" + r] ||\r\n        w[\"msR\" + r] ||\r\n        w[\"oR\" + r] ||\r\n        function (c) {\r\n          console.log(\"RRR\");\r\n          w.setTimeout(c, 1000 / 60);\r\n        };\r\n    })(window, \"equestAnimationFrame\");\r\n  }\r\n\r\n  return (\r\n    <canvas id=\"sakura\" style={{ display: 'block'}}></canvas>\r\n  );\r\n}\r\n"],"names":["bg_fsh","fx_brightbuf_fsh","fx_common_fsh","fx_common_vsh","fx_dirblur_r4_fsh","pp_final_fsh","pp_final_vsh","sakura_point_fsh","sakura_point_vsh","useEffect","fullw","fullh","Vector3","Matrix44","create","x","y","z","dot","v0","v1","cross","v","normalize","l","Math","sqrt","arrayForm","array","Float32Array","createIdentity","loadProjection","m","aspect","vdeg","near","far","h","tan","PI","w","loadLookAt","vpos","vlook","vup","frontv","sidev","topv","gl","timeInfo","start","prev","delta","elapsed","renderSpec","width","height","halfWidth","halfHeight","halfArray","deleteRenderTarget","rt","deleteFramebuffer","frameBuffer","deleteRenderbuffer","renderBuffer","deleteTexture","texture","createRenderTarget","ret","sizeArray","dtxArray","createFramebuffer","createRenderbuffer","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","compileShader","shtype","shsrc","retsh","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","errlog","getShaderInfoLog","deleteShader","console","error","vtxsrc","frgsrc","uniformlist","attrlist","vsh","VERTEX_SHADER","fsh","FRAGMENT_SHADER","prog","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniforms","i","length","getUniformLocation","attributes","attr","getAttribLocation","cShader","useProgram","enableVertexAttribArray","uncShader","disableVertexAttribArray","setSize","floor","projection","angle","nearfar","matrix","camera","position","lookat","up","dof","pointFlower","sceneStandBy","BlossomParticle","this","velocity","Array","rotation","euler","size","alpha","zkey","createPointFlowers","prm","getParameter","ALIASED_POINT_SIZE_RANGE","pointSize","min","max","sakura","program","offset","fader","numFlowers","particles","dataArray","positionArrayOffset","eulerArrayOffset","miscArrayOffset","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","initPointFlowers","area","PI2","tmpv3","tmpv","symmetryrand","random","tmpprtcl","setVelocity","setRotation","setPosition","setEulerAngles","renderPointFlowers","repeatPos","prt","cmp","limit","abs","repeatEuler","prtcl","update","sort","p0","p1","ipos","ieuler","imisc","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","uniformMatrix4fv","uProjection","uModelview","uniform3fv","uResolution","uDOF","uFade","vertexAttribPointer","aPosition","FLOAT","BYTES_PER_ELEMENT","aEuler","aMisc","zpos","uOffset","drawArrays","POINT","DEPTH_TEST","disable","createEffectProgram","exunifs","exattrs","unifs","concat","attrs","STATIC_DRAW","cEffect","fxobj","srctex","uniform2fv","uDelta","uniform1i","uSrc","activeTexture","TEXTURE0","drawEffect","TRIANGLE_STRIP","uncEffect","prototype","vx","vy","vz","rx","ry","rz","nx","ny","nz","s","dt","et","effectLib","createEffectLib","cmnvtxsrc","sceneBg","mkBrightBuf","dirBlur","finalComp","createBackground","initBackground","renderBackground","uniform2f","uTimes","createPostProcess","initPostProcess","renderPostProcess","bindRT","isclear","viewport","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","wHalfRT0","mainRT","p","wHalfRT1","uniform4f","uBlurDir","uBloom","TEXTURE1","createScene","initScene","atan2","renderScene","onResize","e","makeCanvasFullScreen","document","getElementById","setViewports","canvas","rtfunc","rtname","rtw","rth","render","animating","animate","curdate","Date","requestAnimationFrame","b","body","d","documentElement","clientWidth","clientHeight","window","removeEventListener","getContext","alert","addEventListener","r","c","log","setTimeout","init","_jsx","id","style","display"],"sourceRoot":""}